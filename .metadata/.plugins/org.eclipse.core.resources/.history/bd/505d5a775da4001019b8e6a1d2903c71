package com.project.mapper;

import com.project.dto.*;
import com.project.entity.*;
import org.springframework.stereotype.Component;

import java.util.List;
import java.util.stream.Collectors;

@Component
public class EntityMapper {

    // ===============================
    // Employee Mapping
    // ===============================
    public EmployeeDTO toEmployeeDTO(Employee employee) {
        if (employee == null) return null;

        return EmployeeDTO.builder()
                .id(employee.getId())
                .fullName(employee.getFullName())
                .email(employee.getEmail())
                .department(employee.getDepartment())
                .designation(employee.getDesignation())
                .accountNumber(employee.getAccountNumber())
                .ifscCode(employee.getIfscCode())
                .bankName(employee.getBankName())
                .documentUrl(employee.getDocumentUrl())
                .verificationStatus(employee.getVerificationStatus() != null ? employee.getVerificationStatus().name() : null)
                .basicSalary(employee.getBasicSalary())
                .hra(employee.getHra())
                .da(employee.getDa())
                .pf(employee.getPf())
                .allowances(employee.getAllowances())
                .organizationId(employee.getOrganization() != null ? employee.getOrganization().getId() : null)
                .build();
    }

    public Employee toEmployeeEntity(EmployeeDTO dto, Organization organization) {
        if (dto == null) return null;

        return Employee.builder()
                .id(dto.getId())
                .fullName(dto.getFullName())
                .email(dto.getEmail())
                .department(dto.getDepartment())
                .designation(dto.getDesignation())
                .accountNumber(dto.getAccountNumber())
                .ifscCode(dto.getIfscCode())
                .bankName(dto.getBankName())
                .documentUrl(dto.getDocumentUrl())
                .verificationStatus(dto.getVerificationStatus() != null ? VerificationStatus.valueOf(dto.getVerificationStatus()) : null)
                .basicSalary(dto.getBasicSalary())
                .hra(dto.getHra())
                .da(dto.getDa())
                .pf(dto.getPf())
                .allowances(dto.getAllowances())
                .organization(organization)
                .build();
    }

    public List<EmployeeDTO> toEmployeeDTOList(List<Employee> employees) {
        return employees == null ? null :
                employees.stream().map(this::toEmployeeDTO).collect(Collectors.toList());
    }

    // ===============================
    // Organization Mapping
    // ===============================
    public OrganizationDTO toOrganizationDTO(Organization org) {
        if (org == null) return null;

        return OrganizationDTO.builder()
                .id(org.getId())
                .organizationName(org.getOrgName())
                .address(org.getAddress())
                .email(org.getContactEmail())
                .documentUrl(org.getDocumentUrl())
                .verificationStatus(org.getVerificationStatus() != null ? org.getVerificationStatus().name() : null)
                .bankId(org.getBank() != null ? org.getBank().getId() : null)
                .build();
    }

    public Organization toOrganizationEntity(OrganizationDTO dto, Bank bank) {
        if (dto == null) return null;

        return Organization.builder()
                .id(dto.getId())
                .orgName(dto.getOrganizationName())
                .address(dto.getAddress())
                .contactEmail(dto.getEmail())
                .documentUrl(dto.getDocumentUrl())
                .verificationStatus(dto.getVerificationStatus() != null ? VerificationStatus.valueOf(dto.getVerificationStatus()) : null)
                .bank(bank)
                .build();
    }

    // ===============================
    // BankAdmin Mapping
    // ===============================
    public BankAdminDTO toBankAdminDTO(BankAdmin admin) {
        if (admin == null) return null;

        return BankAdminDTO.builder()
                .id(admin.getId())
                .name(admin.getName())
                .email(admin.getEmail())
                .contactNumber(admin.getContactNumber())
                .bankId(admin.getBank() != null ? admin.getBank().getId() : null)
                .build();
    }

    public BankAdmin toBankAdminEntity(BankAdminDTO dto, Bank bank) {
        if (dto == null) return null;

        return BankAdmin.builder()
                .id(dto.getId())
                .name(dto.getName())
                .email(dto.getEmail())
                .contactNumber(dto.getContactNumber())
                .bank(bank)
                .build();
    }

    // ===============================
    // SalaryPayment Mapping
    // ===============================
    public SalaryPaymentDTO toSalaryPaymentDTO(SalaryPayment payment) {
        if (payment == null) return null;

        return SalaryPaymentDTO.builder()
                .id(payment.getId())
                .amount(payment.getAmount())
                .paymentDate(payment.getPaymentDate())
                .salaryMonth(payment.getSalaryMonth())
                .status(payment.getStatus() != null ? payment.getStatus().name() : null)
                .employeeId(payment.getEmployee() != null ? payment.getEmployee().getId() : null)
                .organizationId(payment.getOrganization() != null ? payment.getOrganization().getId() : null)
                .verifiedByAdminId(payment.getVerifiedBy() != null ? payment.getVerifiedBy().getId() : null)
                .build();
    }

    public SalaryPayment toSalaryPaymentEntity(SalaryPaymentDTO dto, Employee employee, Organization organization, BankAdmin verifiedBy) {
        if (dto == null) return null;

        return SalaryPayment.builder()
                .id(dto.getId())
                .amount(dto.getAmount())
                .paymentDate(dto.getPaymentDate())
                .salaryMonth(dto.getSalaryMonth())
                .status(dto.getStatus() != null ? SalaryStatus.valueOf(dto.getStatus()) : null)
                .employee(employee)
                .organization(organization)
                .verifiedBy(verifiedBy)
                .build();
    }
}
